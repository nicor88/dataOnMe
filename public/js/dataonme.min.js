var app=angular.module("dataOnMe",["ngRoute","highcharts-ng","ui.bootstrap"]);!function(){var a=function(a){a.when("/",{templateUrl:"../fuelConsumationViews/viewCars.html",controller:"viewCarsController"}).when("/updateuserdata",{templateUrl:"../dataOnMeViews/updateUserData.html",controller:"updateUserController"}).when("/fuelconsumation/viewcars",{templateUrl:"../fuelConsumationViews/viewCars.html",controller:"viewCarsController"}).when("/fuelconsumation/insertcar",{templateUrl:"../fuelConsumationViews/insertCar.html",controller:"insertCarController"}).when("/fuelconsumation/updatecar/:carId",{templateUrl:"../fuelConsumationViews/updateCar.html",controller:"updateCarController"}).when("/fuelconsumation/removecar/:carId",{templateUrl:"../fuelConsumationViews/removeCar.html",controller:"removeCarController"}).when("/fuelconsumation/insertrefuelling/:carId",{templateUrl:"../fuelConsumationViews/insertRefuelling.html",controller:"insertRefuellingController"}).when("/fuelconsumation/viewcardata/:carId",{templateUrl:"../fuelConsumationViews/viewCarData.html",controller:"viewCarDataController"}).when("/fuelconsumation/viewcarcharts/:carId",{templateUrl:"../fuelConsumationViews/viewCarCharts.html",controller:"viewCarDataController"}).when("/fuelconsumation/viewcarmonthlydata/:carId/:monthYear",{templateUrl:"../fuelConsumationViews/viewCarMonthlyData.html",controller:"viewCarMonthlyData"}).when("/fuelconsumation/viewcardashboard/:carId",{templateUrl:"../fuelConsumationViews/viewCarDashboard.html",controller:"viewCarDashboard"})};a.$inject=["$routeProvider"],app.config(a)}(),function(){var a=function(a,b,c){var d=new Date;a.inserterror=!1,a.insertsuccess=!1,a.formData={},a.fuelTypes=["Benzin","Diesel","Gas","Methan"],a.formData.fuel="Benzin",b.get("isAuth?date="+d.toISOString()).success(function(a){a.logged||(c.location="/login")}),a.processForm=function(){b({method:"POST",url:"insertcar",data:$.param(a.formData),headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"}}).success(function(b){b.error?(a.inserterror=!0,a.insertsuccess=!1,"no-auth"==b.message?(a.error="You are not authenticated!",c.location="/login"):a.error=b.message):(a.inserterror=!1,a.insertsuccess=!0,a.info=a.formData.name+" inserted!",a.formData={},c.location="#/fuelconsumation/viewcars")}).error(function(){a.inserterror=!0,a.insertsuccess=!1,a.error="There was an error, re-try to insert!"})}};a.$inject=["$scope","$http","$window"],angular.module("dataOnMe").controller("insertCarController",a)}(),function(){var a=function(a,b,c,d,e){var f=b.carId,g=new Date;a.inserterror=!1,a.insertsuccess=!1,a.onlyUpdate=!1,a.formData={},a.updateData={};var h=function(){a.paymentsType=["Cash","Bancomat","Credit Card"],a.formData.paymentType="Cash",c.get("car/"+f+"?date="+g.toISOString(),{cache:!1}).success(function(b){1==b.length&&(b=b[0],a.formData.fueltype=b.fuel)})};h(),c.get("isAuth?date="+g.toISOString(),{cache:!1}).success(function(a){a.logged||(e.location="/login")}),c.get("lastrefuelling/"+f+"?date="+g.toISOString(),{cache:!1}).success(function(b){0===b.length?(a.firstInsert=!0,a.showUpdateAndInsert=!1):(a.firstInsert=!1,a.showUpdateAndInsert=!0,a.updateData=b[0],a.updateData.liters=a.updateData.amount/a.updateData.fuelprice)}),a.insertForm=function(){a.formData.carId=f,a.formData.date=new Date,c({method:"POST",url:"insertrefuelling",data:$.param(a.formData),headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"}}).success(function(b){b.error?(a.inserterror=!0,a.insertsuccess=!1,"no-auth"==b.message?(a.error="You are not authenticated!",e.location="/login"):a.error=b.message):(a.inserterror=!1,a.insertsuccess=!0,a.info=b.message,c.get("lastrefuelling/"+f,{cache:!1}).success(function(b){0===b.length?(a.firstInsert=!0,a.showUpdateAndInsert=!1):(a.firstInsert=!1,a.showUpdateAndInsert=!0,a.formData={},h(),a.updateData=b[0],a.updateData.liters=a.updateData.amount/a.updateData.fuelprice)}))}).error(function(){a.inserterror=!0,a.insertsuccess=!1,a.error="There was an error, re-try to insert!"})},a.updateAndInsertForm=function(){a.formData.carId=f,a.formData.date=new Date,a.formData.liters=a.formData.amount/a.formData.fuelprice,a.updateData.liters=a.updateData.amount/a.updateData.fuelprice,a.updateData.consumation=a.updateData.kms/a.updateData.liters,a.updateData.lastUpdate=new Date;var b=c({method:"POST",url:"updaterefuelling/"+a.updateData._id,data:$.param(a.updateData),headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"}}),e=c({method:"POST",url:"insertrefuelling",data:$.param(a.formData),headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"}});d.all([b,e]).then(function(b){var d=b[0].data,e=b[1].data;d.success&&e.success?(a.firstInsert=!1,a.showUpdateAndInsert=!1,a.insertsuccess=!0,a.info="Update and new insert correct!"):d.success?(a.firstInsert=!1,a.showUpdateAndInsert=!1,a.insertsuccess=!0,a.info="Update correct!",a.inserterror=!0,a.error="Error trying to insert new Refuelling!"):e.success&&(a.firstInsert=!1,a.showUpdateAndInsert=!1,a.inserterror=!0,a.error="Error trying to update Refuelling",a.onlyUpdate=!0,c.get("lastrefuellings/"+f).success(function(b){a.updateData=b[1],a.updateData.liters=a.updateData.amount/a.updateData.fuelprice}))})},a.updateForm=function(){a.updateData.liters=a.updateData.amount/a.updateData.fuelprice,a.updateData.consumation=a.updateData.kms/a.updateData.liters,a.updateData.lastUpdate=new Date,c({method:"POST",url:"updaterefuelling/"+a.updateData._id,data:$.param(a.updateData),headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"}}).success(function(b){b.error?(a.inserterror=!0,a.insertsuccess=!1,"no-auth"==b.message?(a.error="You are not authenticated!",e.location="/login"):a.error=b.message):(a.inserterror=!1,a.insertsuccess=!0,a.info=b.message)})}};a.$inject=["$scope","$routeParams","$http","$q","$window"],angular.module("dataOnMe").controller("insertRefuellingController",a)}(),function(){var a=function(a,b,c,d){var e=b.carId,f=new Date;a.showdeleteform=!0,a.deleteerror=!1,a.deletesuccess=!1,a.formData={},a.car={},c.get("car/"+e+"?date="+f.toISOString(),{cache:!1}).success(function(b){if(1==b.length){var c=b[0];a.car.brand=c.brand,a.car.model=c.model}}),c.get("isAuth?date="+f.toISOString(),{cache:!1}).success(function(a){a.logged||(d.location="/login")}),a.processForm=function(){c({method:"POST",url:"removecar/"+e,data:$.param(a.formData),headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"}}).success(function(b){b.error?(a.deleteerror=!0,a.deletesuccess=!1,"no-auth"==b.message?(a.error="You are not authenticated!",d.location="/login"):a.error=b.message):(a.deleteerror=!1,a.deletesuccess=!0,a.info=b.message,d.location="#/fuelconsumation/viewcars")}).error(function(){a.deleteerror=!0,a.deletesuccess=!1,a.error="There was an error, re-try to delete!"})}};a.$inject=["$scope","$routeParams","$http","$window"],angular.module("dataOnMe").controller("removeCarController",a)}(),function(){var a=function(a,b,c,d){var e=b.carId,f=new Date;a.updateerror=!1,a.updatesuccess=!1,a.formData={},c.get("isAuth?date="+f.toISOString(),{cache:!1}).success(function(a){a.logged||(d.location="/login")}),c.get("car/"+e+"?date="+f.toISOString(),{cache:!1}).success(function(b){if(1==b.length){var c=b[0];a.formData.fuel=c.fuel,a.formData.year=c.year,a.formData.description=c.description}}),a.processForm=function(){c({method:"POST",url:"updatecar/"+e,data:$.param(a.formData),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(b){console.log(b),b.error?(a.updateerror=!0,a.updatesuccess=!1,"no-auth"==b.message?(a.error="You are not authenticated!",d.location="/login"):a.error=b.message):(a.updateerror=!1,a.updatesuccess=!0,a.info=b.message)}).error(function(){a.updateerror=!0,a.updatesuccess=!1,a.error="There was an error, re-try to update!"})}};a.$inject=["$scope","$routeParams","$http","$window"],angular.module("dataOnMe").controller("updateCarController",a)}(),function(){var a=function(a,b,c){var d=new Date;b.get("isAuth?date="+d.toISOString(),{cache:!1}).success(function(a){a.logged||(c.location="/login")}),a.message="Update User data"};a.$inject=["$scope","$http","$window"],angular.module("dataOnMe").controller("updateUserController",a)}(),function(){var a=function(a,b,c,d,e,f,g){var h=b.carId,i=g.getMonthsByName();a.showSpinner=!0,d.isAuth().success(function(a){a.logged||(c.location="/login")}).error(function(a,b,c,d){}),e.getCar(h).success(function(b){a.dashboard_output="Dashboard of ",a.dashboard_output+=b[0].model+" ",a.dashboard_output+=b[0].name+" "}).error(function(a,b,c,d){}),a.onClickBar=function(a){console.log("redirect to: #/fuelconsumation/viewcarmonthlydata/"+h+"/"+a),c.location="#/fuelconsumation/viewcarmonthlydata/"+h+"/"+a},a.createCharts=function(b){f.getMonthlyStatistics(h,b).success(function(c){var d=[];a.kms_data=[],a.amount_data=[];var e=[];c.forEach(function(c){d.push(i[c.month-1]+"-"+b);var f={name:i[c.month-1]+"-"+b,y:c.kmsTotal};a.kms_data.push(f);var g={name:i[c.month-1]+"-"+b,y:c.amountTotal};a.amount_data.push(g),e.push(c.avgConsumation)});var f=[{name:"Kms: ",colorByPoint:!0,type:"pie",data:a.kms_data}],h=[{name:"Total Amount of €",colorByPoint:!0,type:"pie",data:a.amount_data}],j=[{name:"Consumption (Km/l)",color:"#DC143C",data:e}];a.chartConfig1=g.configurePieChart("Kms for each month of "+b,"","kms",f,a.onClickBar),a.chartConfig2=g.configurePieChart("Total Amount of € for each month of "+b,"","€",h,a.onClickBar),a.chartBarConfig=g.configureColumnChart("Average consumption for "+b,"","Months","Km/l","Km/l",d,j,a.onClickBar),a.showSpinner=!1}).error(function(a,b,c,d){})},f.getYears(h).success(function(b){a.years=[],b.forEach(function(b){a.years.push(b._id)}),a.selectedYear=a.years[0],a.createCharts(a.selectedYear)}).error(function(a,b,c,d){}),a.updateChart=function(){a.createCharts(a.selectedYear)}};a.$inject=["$scope","$routeParams","$window","authFactory","carsFactory","refuellingFactory","chartsFactory"],angular.module("dataOnMe").controller("viewCarDashboard",a)}(),function(){var a=function(a,b,c,d,e,f,g,h,i){var j=c.carId;a.showSpinner=!0,f.isAuth().success(function(a){a.logged||(e.location="/login")}).error(function(a,b,c,d){}),a.reverse=!0,a.sortBy="date",a.showChart=!1,a.refuellingFilter={date:"",brand:"",city:""},a.sortByField=function(b){a.sortBy=b,a.reverse=!a.reverse},a.open=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!0},a.dateOptions={formatYear:"yy",startingDay:1},g.getCar(j).success(function(b){a.chartTitle="Consumation of "+b[0].model+" "+b[0].brand}).error(function(a,b,c,d){}),a.onChangeDate=function(){void 0!==a.refuellingFilter.date&&(a.refuellingFilter.date=i.formatDate(a.refuellingFilter.date))},a.filterByDay=function(b){a.refuellingFilter.date=i.formatDate(b),a.$apply()},h.getAllRefuelling(j).success(function(b){a.refuellings=[],a.consumation=[],a.date=[],b.forEach(function(b){if(null!==b.consumation&&0!==parseFloat(b.consumation)){var c=b.city;void 0===b.city&&(c="");var d=b.address;void 0===b.address&&(d="");var e=b.brand;void 0===b.brand&&(e="");var f=b.fuelprice;void 0===b.fuelprice&&(f="");var g={date:b.date,amount:b.amount,fuelprice:f,liters:b.liters,kms:b.kms,consumation:b.consumation,brand:e,city:c,address:d};a.refuellings.push(g);var h=new Date(b.date);a.date.push(h.toDateString()),a.consumation.push(b.consumation)}});var c=[{name:"Consumation (Km/l)",type:"area",color:"#DC143C",data:a.consumation}];a.chartConfig=i.configureAreaChart(a.chartTitle,"Days",a.date,"Km/l",c,a.filterByDay),a.showSpinner=!1}).error(function(a,b,c,d){})};a.$inject=["$scope","$rootScope","$routeParams","$http","$window","authFactory","carsFactory","refuellingFactory","chartsFactory"],angular.module("dataOnMe").controller("viewCarDataController",a)}(),function(){var a=function(a,b,c,d,e,f,g){var h=b.carId,i=b.monthYear;a.carId=h,a.monthYear=i,a.showSpinner=!0,a.reverse=!0,a.sortBy="date",a.showChart=!1,a.refuellingFilter={date:"",brand:"",city:""},a.sortByField=function(b){a.sortBy=b,a.reverse=!a.reverse},d.isAuth().success(function(a){a.logged||(c.location="/login")}).error(function(a,b,c,d){}),e.getCar(h).success(function(b){a.dashboard_title="Dashboard of ",a.dashboard_title+=b[0].model+" ",a.dashboard_title+=b[0].name+" ",a.dashboard_title+=i}).error(function(a,b,c,d){}),f.getMonthRefuellings(h,i).success(function(b){a.refuellings=[],a.date=[],a.consumption=[],b.forEach(function(b){if(null!==b.consumation&&0!==parseFloat(b.consumation)){var c=b.city;void 0===b.city&&(c="");var d=b.address;void 0===b.address&&(d="");var e=b.brand;void 0===b.brand&&(e="");var f=b.fuelprice;void 0===b.fuelprice&&(f="");var h={date:b.date,amount:b.amount,fuelprice:f,liters:b.liters,kms:b.kms,consumation:b.consumation,brand:e,city:c,address:d};a.refuellings.push(h);var j=new Date(b.date);a.date.push(j.toDateString()),a.consumption.push(b.consumation)}var k=[{name:"Consumption (Km/l)",data:a.consumption}];a.chartLineConfig=g.configureLineChart("Consumption for "+i,"","Date","Km/l","Km/l",a.date,k),a.showSpinner=!1})}).error(function(a,b,c,d){})};a.$inject=["$scope","$routeParams","$window","authFactory","carsFactory","refuellingFactory","chartsFactory"],angular.module("dataOnMe").controller("viewCarMonthlyData",a)}(),function(){var a=function(a,b,c,d,e){a.alerts=[],d.isAuth().success(function(a){a.logged||(c.location="/login")}).error(function(b,c,d,e){a.alerts.push({type:"danger",msg:"There was an error getting data!"})}),e.getCars().success(function(b){a.cars=b}).error(function(b,c,d,e){a.alerts.push({type:"danger",msg:"There was an error getting data!"})}),a.closeAlert=function(b){a.alerts.splice(b,1)};setInterval(function(){a.alerts=[],a.$apply()},5e3)};a.$inject=["$scope","$http","$window","authFactory","carsFactory"],angular.module("dataOnMe").controller("viewCarsController",a)}(),function(){var a=function(){return{restrict:"E",replace:!0,template:"<div></div>",scope:{config:"="},link:function(a,b){var c,d=function(){var d={chart:{renderTo:b[0]}},e=angular.extend(d,a.config);c=new Highcharts.Chart(e)};d(),a.$watch("config.series",function(){d()}),a.$watch("config.loading",function(a){c&&(a?c.showLoading():c.hideLoading())})}}};angular.module("dataOnMe").directive("chart",a)}(),function(){var a=function(a){var b={};return b.isAuth=function(){var b=new Date;return a.get("isAuth?date="+b.toISOString(),{cache:!1})},b};a.$inject=["$http"],angular.module("dataOnMe").factory("authFactory",a)}(),function(){var a=function(a){var b={};return b.getCars=function(){var b=new Date;return a.get("cars?date="+b.toISOString(),{cache:!1})},b.getCar=function(b){var c=new Date;return a.get("car/"+b+"?date="+c.toISOString(),{cache:!1})},b};a.$inject=["$http"],angular.module("dataOnMe").factory("carsFactory",a)}(),function(){var a=function(){var a={};return a.isAuth=function(){var a=new Date;return $http.get("isAuth?date="+a.toISOString(),{cache:!1})},a.configureAreaChart=function(a,b,c,d,e,f){var g={title:{text:a},subtitle:{text:"Last Update: "+new Date},xAxis:{title:{text:b},labels:{rotation:-45,style:{fontSize:"11px",fontFamily:"Arial"}},categories:c},tooltip:{pointFormat:"{point.y:.2f} Km/l"},yAxis:{title:{text:d}},series:e,options:{chart:{zoomType:"xy"},plotOptions:{series:{marker:{enabled:!0},point:{events:{click:function(){f(this.category)}}}}},lang:{back:"Go Back to Previous Chart",refresh:"Refresh Chart"},exporting:{buttons:{contextButton:{enabled:!0},exportButton:{enabled:!1},printButton:{enabled:!1}}}},credits:{enabled:!1},loading:!1};return g},a.configureColumnChart=function(a,b,c,d,e,f,g,h){var i={title:{text:a},subtitle:{text:"Last Update: "+new Date},xAxis:{title:{text:c},labels:{rotation:-45,style:{fontSize:"11px",fontFamily:"Arial"}},categories:f},yAxis:{title:{text:d}},series:g,options:{chart:{zoomType:"xy",type:"column"},tooltip:{pointFormat:"{point.y:.2f}"+e},legend:{enabled:!1,layout:"vertical",align:"right",verticalAlign:"top",x:-40,y:100,floating:!0,borderWidth:1,backgroundColor:"#FFFFFF",shadow:!0},plotOptions:{series:{marker:{enabled:!0},point:{events:{click:function(){h(this.category)}}}}},exporting:{buttons:{contextButton:{enabled:!0},exportButton:{enabled:!1},printButton:{enabled:!1}}}},credits:{enabled:!1},loading:!1};return i},a.configureLineChart=function(a,b,c,d,e,f,g){var h={title:{text:a},subtitle:{text:"Last Update: "+new Date},xAxis:{title:{text:c},labels:{rotation:-45,style:{fontSize:"11px",fontFamily:"Arial"}},categories:f},yAxis:{title:{text:d}},series:g,options:{chart:{zoomType:"xy",type:"line"},tooltip:{pointFormat:"{point.y:.2f}"+e},legend:{enabled:!1,layout:"vertical",align:"right",verticalAlign:"top",x:-40,y:100,floating:!0,borderWidth:1,backgroundColor:"#FFFFFF",shadow:!0},plotOptions:{series:{marker:{enabled:!0},point:{events:{click:function(){console.log(this.category)}}}}},exporting:{buttons:{contextButton:{enabled:!0},exportButton:{enabled:!1},printButton:{enabled:!1}}}},credits:{enabled:!1},loading:!1};return h},a.configurePieChart=function(a,b,c,d,e){var f={chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:a},subtitle:{text:"Last Update: "+new Date},series:d,options:{chart:{zoomType:"xy"},tooltip:{enabled:!0,pointFormat:"<b>{point.y:.1f}</b> "+c},plotOptions:{series:{marker:{enabled:!0},point:{events:{click:function(){e(this.name),console.log(this)}}}},pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},exporting:{buttons:{contextButton:{enabled:!0},exportButton:{enabled:!1},printButton:{enabled:!1}}}},credits:{enabled:!1},loading:!1};return f},a.getMonthsByName=function(){var a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return a},a.formatDate=function(a){a=new Date(a);var b=a.getFullYear(),c=a.getMonth()+1;10>c&&(c="0"+c);var d=a.getDate();return 10>d&&(d="0"+d),b+"-"+c+"-"+d},a};angular.module("dataOnMe").factory("chartsFactory",a)}(),function(){var a=function(a){var b={};return b.getYears=function(b){var c=new Date;return a.get("refuellings/years/"+b+"?date="+c.toISOString(),{cache:!1})},b.getAllRefuelling=function(b){var c=new Date;return a.get("refuellings/"+b+"?date="+c.toISOString(),{cache:!1})},b.getMonthRefuellings=function(b,c){var d=new Date;return a.get("refuellings/monthData/"+b+"/"+c+"?date="+d.toISOString(),{cache:!1})},b.getMonthlyStatistics=function(b,c){var d=new Date;return a.get("refuellings/statistics/"+b+"/"+c+"?date="+d.toISOString(),{cache:!1})},b};a.$inject=["$http"],angular.module("dataOnMe").factory("refuellingFactory",a)}();